---
- name: TASKS | VM_CREATE | Destroy VM if exist
  community.general.proxmox_kvm:
    api_user: "{{ pve_api_user }}"
    api_token_id: "{{ pve_api_token_id }}"
    api_token_secret: "{{ pve_api_token_secret }}"
    api_host: "127.0.0.1"
    node: "{{ local_pve_node.stdout }}"
    vmid: "{{ pve_vm_id }}"
    state: absent

- name: TASKS | VM_CREATE | Create VM
  community.general.proxmox_kvm:
    api_user: "{{ pve_api_user }}"
    api_token_id: "{{ pve_api_token_id }}"
    api_token_secret: "{{ pve_api_token_secret }}"
    api_host: "127.0.0.1"
    node: "{{ local_pve_node.stdout }}"
    vmid: "{{ pve_vm_id }}"
    state: present
    agent: "{{ pve_vm_agent }}"
    balloon: "{{ pve_vm_balloon }}"
    bios: "{{ pve_vm_bios }}"
    boot: "{{ pve_vm_boot }}"
    cipassword: "{{ pve_vm_cipassword }}"
    ciuser: "{{ pve_vm_ciuser }}"
    cores: "{{ pve_vm_cores }}"
    cpu: "{{ pve_vm_cpu }}"
    cpulimit: "{{ pve_vm_cpulimit }}"
    hotplug: "{{ pve_vm_hotplug }}"
    keyboard: "{{ pve_vm_keyboard }}"
    machine: "{{ pve_vm_machine }}"
    memory: "{{ pve_vm_memory }}"
    name: "{{ pve_vm_name }}"
    numa_enabled: "{{ pve_vm_numa_enabled }}"
    onboot: "{{ pve_vm_onboot }}"
    ostype: "{{ pve_vm_ostype }}"
    sata:
      sata0: "{{ pve_vm_sata_sata0 | default(omit) }}"
      sata1: "{{ pve_vm_sata_sata1 | default(omit) }}"
      sata2: "{{ pve_vm_sata_sata2 | default(omit) }}"
      sata3: "{{ pve_vm_sata_sata3 | default(omit) }}"
      sata4: "{{ pve_vm_sata_sata4 | default(omit) }}"
      sata5: "{{ pve_vm_sata_sata5 | default(omit) }}"
    scsihw: "{{ pve_vm_scsihw }}"
    serial: "{{ pve_vm_serial }}"
    vga: "{{ pve_vm_vga }}"
    virtio:
      virtio0: "{{ pve_vm_virtio_virtio0 | default(omit) }}"
      virtio1: "{{ pve_vm_virtio_virtio1 | default(omit) }}"
      virtio2: "{{ pve_vm_virtio_virtio2 | default(omit) }}"
      virtio3: "{{ pve_vm_virtio_virtio3 | default(omit) }}"
      virtio4: "{{ pve_vm_virtio_virtio4 | default(omit) }}"
      virtio5: "{{ pve_vm_virtio_virtio5 | default(omit) }}"